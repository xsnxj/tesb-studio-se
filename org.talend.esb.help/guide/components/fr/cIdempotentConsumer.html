<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>cIdempotentConsumer</title><meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1"><link rel="home" href="index.html" title="Talend Open Studio"><link rel="up" href="ch06.html" title="Chapitre&nbsp;6.&nbsp;Composants Routing"><link rel="prev" href="cDynamicRouter.html" title="cDynamicRouter"><link rel="next" href="cLoadBalancer.html" title="cLoadBalancer"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div lang="fr" class="section" title="cIdempotentConsumer"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cIdempotentConsumer"></a>cIdempotentConsumer</h2></div></div></div><div class="mediaobject"><img src="../images/cIdempotentConsumer_icon32_white.png"></div><div class="section" title="Propri&eacute;t&eacute;s du cIdempotentConsumer"><div class="titlepage"><div><div><h3 class="title"><a name="d0e11312"></a>Propri&eacute;t&eacute;s du cIdempotentConsumer</h3></div></div></div><div class="informaltable"><table border="1"><colgroup><col class="c1"><col class="c2"><col class="c3"></colgroup><tbody><tr><td valign="top"><p><span class="bold"><strong>Famille de composant</strong></span></p>
						</td><td colspan="2" valign="top"><p>Routing</p>
						</td></tr><tr><td valign="top"><p><span class="bold"><strong>Fonction</strong></span></p>
						</td><td colspan="2" valign="top"><p>Le composant <span class="bold"><strong>cIdempotentConsumer</strong></span> d&eacute;doublonne des messages et
								emp&ecirc;che que l'endpoint r&eacute;cepteur re&ccedil;oive les messages en doublon. </p>
						</td></tr><tr><td valign="top"><p><span class="bold"><strong>Objectif</strong></span></p>
						</td><td colspan="2" valign="top"><p>Le <span class="bold"><strong>cIdempotentConsumer</strong></span> identifie les messages d&eacute;j&agrave; envoy&eacute;s au
								r&eacute;cepteur et les &eacute;limine. Les messages sont toujours envoy&eacute;s par
								l'&eacute;metteur mais sont ignor&eacute;s par le r&eacute;cepteur lors de la
								livraison.</p>
						</td></tr><tr><td valign="top"><p><span class="bold"><strong>Basic
								settings</strong></span></p>
						</td><td valign="top"><p><span class="emphasis"><em>Repository Type</em></span></p>
						</td><td valign="top"><p>Les identifiants des messages doivent &ecirc;tre stock&eacute;s dans un Repository. Pour les nouveaux
								messages entrants, les identifiants sont v&eacute;rifi&eacute;s par rapport &agrave; ceux
								stock&eacute;s dans le Repository afin d'identifier et de supprimer les
								doublons. Il y a deux moyens de les stocker :</p><p><span class="bold"><strong>Memory</strong></span> : les identifiants des messages sont stock&eacute;s
								temporairement.</p>
							<div class="warning" title="Avertissement" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="16pt"><img alt="[Avertissement]" src="../images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><span class="emphasis"><em>Le mode de stockage in-memory peut manquer de m&eacute;moire. Il ne fonctionne pas
										dans un environnement en cluster.</em></span></p></td></tr></table></div>
							<p><span class="bold"><strong>File</strong></span> : les identifiants des messages sont stock&eacute;s dans
								un fichier. Sp&eacute;cifiez le chemin d'acc&egrave;s &agrave; ce fichier dans le champ
									<span class="bold"><strong>File store</strong></span>. </p>
						</td></tr><tr><td><p>&nbsp;</p>
						</td><td valign="top"><p><span class="emphasis"><em>File store</em></span></p>
						</td><td valign="top"><p>Sp&eacute;cifiez le chemin d'acc&egrave;s au fichier stockant les identifiants des messages ainsi que son
								nom.</p>
						</td></tr><tr><td><p>&nbsp;</p>
						</td><td valign="top"><p><span class="emphasis"><em>Cache Size</em></span></p>
						</td><td valign="top"><p>Saisissez la taille du cache, c'est-&agrave;-dire le nombre d'identifiants de messages &agrave;
								stocker.</p>
						</td></tr><tr><td><p>&nbsp;</p>
						</td><td valign="top"><p><span class="emphasis"><em>Use language</em></span></p>
						</td><td valign="top"><p>Cochez cette case si vous souhaitez sp&eacute;cifier le langage utilis&eacute;e dans le champ <span class="bold"><strong>Predicate</strong></span> afin de sp&eacute;cifier l'identifiant
								des messages.</p>
						</td></tr><tr><td><p>&nbsp;</p>
						</td><td valign="top"><p><span class="emphasis"><em>Expression</em></span></p>
						</td><td valign="top"><p>Saisissez l'expression &agrave; utiliser pour sp&eacute;cifier l'identifiant des messages.</p>
						</td></tr><tr><td>&nbsp;</td><td valign="top"><span class="italic">Eager</span></td><td valign="top"><p>Cochez cette case pour d&eacute;tecter les messages en doublon m&ecirc;me lorsque les messages sont en
								cours de traitement. D&eacute;cochez-la pour d&eacute;tecter les doublons
								uniquement lorsque les messages ont bien &eacute;t&eacute; trait&eacute;s.</p>
							<p>Cette case est coch&eacute;e par d&eacute;faut.</p></td></tr><tr><td>&nbsp;</td><td valign="top"><span class="italic">SkipDuplicate</span></td><td valign="top"><p>Cochez cette case pour supprimer les doublons. D&eacute;cochez-la pour ignorer les doublons afin de
								traiter tous les messages.</p>
							<p>Cette case est coch&eacute;e par d&eacute;faut.</p></td></tr><tr><td valign="top"><p><span class="bold"><strong>Utilisation</strong></span></p>
						</td><td colspan="2" valign="top"><p>Le <span class="bold"><strong>cIdempotentConsumer</strong></span> est utilis&eacute; comme composant
								interm&eacute;diaire dans une Route.</p>
						</td></tr><tr><td valign="top"><span class="bold"><strong>Connections</strong></span></td><td valign="top"><span class="italic">idemp</span></td><td valign="top">Le lien <span class="bold"><strong>idemp</strong></span> r&eacute;cup&egrave;re les messages
							d&eacute;doublonn&eacute;s par le composant <span class="bold"><strong>cIdempotentConsumer</strong></span>.</td></tr><tr><td valign="top">&nbsp;</td><td valign="top"><span class="italic">Route</span></td><td valign="top">En tant que lien facultatif, le lien <span class="bold"><strong>Route</strong></span> r&eacute;cup&egrave;re tous les messages provenant de
							l'&eacute;metteur.</td></tr><tr><td valign="top"><p><span class="bold"><strong>Limitation</strong></span></p>
						</td><td colspan="2"><p>&nbsp;n/a</p>
						</td></tr></tbody></table></div></div><div class="section" title="Sc&eacute;nario : D&eacute;doublonner des messages pendant leur routage"><div class="titlepage"><div><div><h3 class="title"><a name="d0e11518"></a>Sc&eacute;nario : D&eacute;doublonner des messages pendant leur routage</h3></div></div></div><p>Dans ce sc&eacute;nario, des messages d&eacute;doublonn&eacute;s sont filtr&eacute;s et seul le message unique est rout&eacute;
			vers sa destination.</p><p>Trois fichiers XML ayant le m&ecirc;me contenu, comme affich&eacute; ci-dessus, sont utilis&eacute;s dans ce
			sc&eacute;nario.</p><pre class="programlisting">&lt;people&gt;
	&lt;person id="8"&gt;
		&lt;firstName&gt;Ellen&lt;/firstName&gt;
		&lt;lastName&gt;Ripley&lt;/lastName&gt;
		&lt;city&gt;Washington&lt;/city&gt;
	&lt;/person&gt;
&lt;/people&gt;</pre><div class="section" title="D&eacute;poser et relier les composants"><div class="titlepage"><div><div><h4 class="title"><a name="d0e11528"></a>D&eacute;poser et relier les composants</h4></div></div></div><p>Ce sc&eacute;nario n&eacute;cessite un composant <span class="bold"><strong>cFile</strong></span>, un <span class="bold"><strong>cIdempotentComsumer</strong></span> et deux <span class="bold"><strong>cProcessor</strong></span>.</p><div class="mediaobject"><img src="../images/use_case_cidempotentconsumer1.png"></div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="&Eacute;tape 1"><p>Dans la <span class="bold"><strong>Palette</strong></span>, d&eacute;veloppez la famille <span class="bold"><strong>Messaging</strong></span>, s&eacute;lectionnez le composant <span class="bold"><strong>cFile</strong></span> et d&eacute;posez-le dans l'espace de mod&eacute;lisation
						graphique comme composant de message source.</p></li><li class="step" title="&Eacute;tape 2"><p>Dans la famille <span class="bold"><strong>Routing</strong></span>, s&eacute;lectionnez le composant
							<span class="bold"><strong>cIdempotentComsumer</strong></span> et d&eacute;posez le dans
						l'espace de mod&eacute;lisation graphique comme le composant de d&eacute;doublonnage des
						messages.</p></li><li class="step" title="&Eacute;tape 3"><p>D&eacute;veloppez la famille <span class="bold"><strong>Processor</strong></span>, d&eacute;posez deux composants
							<span class="bold"><strong>cProcessor</strong></span> dans l'espace de
						mod&eacute;lisation graphique, un comme consommateur des messages d&eacute;doublonn&eacute;s et
						un pour tous les autres messages.</p></li><li class="step" title="&Eacute;tape 4"><p>Cliquez-droit sur le <span class="bold"><strong>cFile</strong></span>, s&eacute;lectionnez <span class="bold"><strong>Row</strong></span> &gt; <span class="bold"><strong>Route</strong></span> dans
						le menu contextuel et cliquez sur le composant <span class="bold"><strong>cIdempotentComsumer</strong></span>.</p></li><li class="step" title="&Eacute;tape 5"><p>Cliquez-droit sur le <span class="bold"><strong>cIdempotentComsumer</strong></span>, s&eacute;lectionnez
							<span class="bold"><strong>Row</strong></span> &gt; <span class="bold"><strong>idemp</strong></span> dans le menu contextuel et cliquez sur le composant
							<span class="bold"><strong>cProcessor</strong></span> du dessus.</p></li><li class="step" title="&Eacute;tape 6"><p>Reliez le composant <span class="bold"><strong>cIdempotentComsumer</strong></span> &agrave; l'autre
							<span class="bold"><strong>cProcessor</strong></span> &agrave; l'aide d'un lien <span class="bold"><strong>Row</strong></span> &gt; <span class="bold"><strong>Route</strong></span>. Ce
						lien facultatif r&eacute;cup&egrave;re tous les messages provenant de la source.</p></li><li class="step" title="&Eacute;tape 7"><p>Renommez les composants comme vous le souhaitez afin de mieux identifier leur r&ocirc;le dans
						la Route.</p></li></ol></div></div><div class="section" title="Configurer les composants et les connexions"><div class="titlepage"><div><div><h4 class="title"><a name="d0e11624"></a>Configurer les composants et les connexions</h4></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="&Eacute;tape 1"><p>Double-cliquez sur le <span class="bold"><strong>cFile</strong></span> nomm&eacute; <span class="italic">Source</span>, pour afficher sa vue <span class="bold"><strong>Basic settings</strong></span>.</p><div class="mediaobject"><img src="../images/use_case_cidempotentconsumer2.png"></div></li><li class="step" title="&Eacute;tape 2"><p>Dans le champ <span class="bold"><strong>Path</strong></span>, sp&eacute;cifiez le chemin d'acc&egrave;s au
						message source. </p><p>Dans la liste <span class="bold"><strong>Encoding</strong></span>, s&eacute;lectionnez le type d'encodage
						de vos fichiers source et laissez les autres param&egrave;tres tels qu'ils
						sont.</p></li><li class="step" title="&Eacute;tape 3"><p>Double-cliquez sur le <span class="bold"><strong>cIdempotentComsumer</strong></span> nomm&eacute;
							<span class="italic">Deduplicator</span>, pour afficher sa vue
							<span class="bold"><strong>Basic settings</strong></span>.</p><div class="mediaobject"><img src="../images/use_case_cidempotentconsumer3.png"></div></li><li class="step" title="&Eacute;tape 4"><p>Dans la liste <span class="bold"><strong>Repository Type</strong></span>, choisissez entre
							<span class="bold"><strong>Memory</strong></span> et <span class="bold"><strong>File</strong></span> pour sp&eacute;cifier l'emplacement de stockage des
						identifiants des messages avant le processus de d&eacute;doublonnage. Dans ce
						sc&eacute;nario, s&eacute;lectionnez <span class="bold"><strong>File</strong></span>.</p><p>Dans le champ <span class="bold"><strong>File store</strong></span>, sp&eacute;cifiez l'emplacement de
						stockage des identifiants des messages.</p><p>Dans le champ <span class="bold"><strong>Expression</strong></span> saisissez une expression pour
						filtrer les messages. Dans ce sc&eacute;nario, saisissez l'expression suivante pour
						filtrer les messages selon le n&#339;ud <span class="emphasis"><em>person</em></span> des fichiers
						XML : <code class="code">xpath("/people/person")</code> et laissez les autres param&egrave;tres
						tels qu'ils sont. Vous pouvez &eacute;galement cocher la case <span class="bold"><strong>Use language</strong></span>, s&eacute;lectionner <span class="bold"><strong>XPath</strong></span> dans la liste <span class="bold"><strong>Language</strong></span> et saisir <code class="code">"/people/person"</code> dans le
						champ <span class="bold"><strong>Predicate</strong></span>.</p></li><li class="step" title="&Eacute;tape 5"><p>Double-cliquez sur le composant <span class="bold"><strong>cProcessor</strong></span> nomm&eacute;
							<span class="italic">Unique</span> afin d'afficher sa vue
							<span class="bold"><strong>Basic settings</strong></span>. </p><div class="mediaobject"><img src="../images/use_case_cidempotentconsumer4.png"></div></li><li class="step" title="&Eacute;tape 6"><p>Dans la zone <span class="bold"><strong>Code</strong></span>, personnalisez le code pour afficher
						le nom de fichier du message passant le d&eacute;doublonnage :</p><pre class="programlisting">System.out.println("Message consumed on Unique: "+
exchange.getIn().getHeader("CamelFileName"));</pre></li><li class="step" title="&Eacute;tape 7"><p>R&eacute;p&eacute;tez ces &eacute;tapes pour configurer l'autre composant <span class="bold"><strong>cProcessor</strong></span> nomm&eacute; <span class="italic">All</span>,
						pour afficher les noms de fichiers de tous les messages provenant de la
						source : </p><pre class="programlisting">System.out.println("Message consumed on All: "+
exchange.getIn().getHeader("CamelFileName"));</pre></li><li class="step" title="&Eacute;tape 8"><p>Appuyez sur <span class="bold"><strong>Ctrl+S</strong></span> pour sauvegarder votre Route.</p></li></ol></div></div><div class="section" title="Visualiser le code et ex&eacute;cuter la Route"><div class="titlepage"><div><div><h4 class="title"><a name="d0e11755"></a>Visualiser le code et ex&eacute;cuter la Route</h4></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="&Eacute;tape 1"><p>Cliquez sur l'onglet <span class="bold"><strong>Code</strong></span> au bas de l'espace de
						mod&eacute;lisation graphique afin de visualiser le code g&eacute;n&eacute;r&eacute;.</p><div class="mediaobject"><img src="../images/use_case_cidempotentconsumer5.png"></div><p>Dans ce morceau de code, les messages provenant de (<code class="code">from</code>) la
							<code class="code">Source</code> sont filtr&eacute;s selon l'expression
							<code class="code">xpath("/people/person")</code> et d&eacute;doublonn&eacute;s par le composant
							<code class="code">cIdempotentConsumer_1</code>.</p></li><li class="step" title="&Eacute;tape 2"><p>Cliquez sur la vue <span class="bold"><strong>Run</strong></span> pour l'afficher et cliquez sur le
						bouton <span class="bold"><strong>Run</strong></span> pour d&eacute;marrer l'ex&eacute;cution de la
						Route. Vous pouvez &eacute;galement appuyer sur <span class="bold"><strong>F6</strong></span>
						pour l'ex&eacute;cuter. </p><p>R&eacute;sultat : Lorsque plusieurs fichiers ont le m&ecirc;me contenu, seul le premier est rout&eacute; vers
						l'endpoint r&eacute;cepteur. </p><div class="mediaobject"><img src="../images/use_case_cidempotentconsumer6.png"></div></li></ol></div></div></div></div></body></html>
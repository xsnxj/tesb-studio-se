<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>cIntercept</title><meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1"><link rel="home" href="index.html" title="Talend Open Studio"><link rel="up" href="ch02.html" title="Chapitre&nbsp;2.&nbsp;Composants Exception"><link rel="prev" href="cErrorHandler.html" title="cErrorHandler"><link rel="next" href="cOnException.html" title="cOnException"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div lang="fr" class="section" title="cIntercept"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cIntercept"></a>cIntercept</h2></div></div></div><div class="mediaobject"><img src="../images/cIntercept_icon32_white.png"></div><div class="section" title="Propri&eacute;t&eacute;s du cIntercept"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1485"></a>Propri&eacute;t&eacute;s du cIntercept</h3></div></div></div><div class="informaltable"><table border="1"><colgroup><col class="c1"><col class="c2"><col class="c3"></colgroup><tbody><tr><td valign="top"><p><span class="bold"><strong>Famille de composant</strong></span></p>
						</td><td colspan="2" valign="top"><p>Exception</p>
						</td></tr><tr><td valign="top"><p><span class="bold"><strong>Fonction</strong></span></p>
						</td><td colspan="2" valign="top"><p>Le composant <span class="bold"><strong>cIntercept</strong></span> intercepte les messages dans toutes
								les sous-routes d'une Route avant leur production et les dirige dans
								une seule nouvelle sous-route sans modifier les valeurs originales.
								Lorsque le d&eacute;tour est effectu&eacute;, le routage des messages vers leurs
								endpoints cible originaux peut continuer.</p>
						</td></tr><tr><td valign="top"><p><span class="bold"><strong>Objectif</strong></span></p>
						</td><td colspan="2" valign="top"><p>Le <span class="bold"><strong>cIntercept</strong></span> intercepte chaque message d'une sous-route et
								le redirige vers une autre sous-route sans modifier la sous-route
								originale. Cela peut &ecirc;tre utile lors de tests pour simuler la
								gestion d'erreurs.</p>
						</td></tr><tr><td valign="top"><p><span class="bold"><strong>Utilisation</strong></span></p>
						</td><td colspan="2" valign="top"><p>Le <span class="bold"><strong>cIntercept</strong></span> est g&eacute;n&eacute;ralement utilis&eacute; comme composant de
								d&eacute;but dans une sous-route.</p>
						</td></tr><tr><td valign="top"><p><span class="bold"><strong>Connections</strong></span></p>
						</td><td valign="top"><p><span class="emphasis"><em>Row / Route</em></span></p>
						</td><td valign="top"><p>S&eacute;lectionnez le lien <span class="bold"><strong>Route</strong></span> pour intercepter tous les messages
								de toutes les sous-routes &eacute;cout&eacute;es par le <span class="bold"><strong>cIntercept</strong></span>.</p>
						</td></tr><tr><td><p>&nbsp;</p>
						</td><td valign="top"><p><span class="emphasis"><em>Trigger / When</em></span></p>
						</td><td valign="top"><p>S&eacute;lectionnez le lien <span class="bold"><strong>When</strong></span> pour filtrer les messages &agrave;
								intercepter et cliquez sur l'onglet <span class="bold"><strong>Component</strong></span>.</p><p>Dans la liste <span class="bold"><strong>Type</strong></span>, s&eacute;lectionnez le type de langage utilis&eacute;
								pour d&eacute;clarer votre condition.</p><p>Dans le champ <span class="bold"><strong>Condition</strong></span>, saisissez la condition utilis&eacute;e pour
								filtrer les messages.</p><p>Tous les messages ne correspondant pas &agrave; cette condition sont rejet&eacute;s, par d&eacute;faut, ou peuvent
								&ecirc;tre r&eacute;cup&eacute;r&eacute;s via un lien <span class="bold"><strong>Otherwise</strong></span> vers un canal diff&eacute;rent. </p>
						</td></tr><tr><td valign="top"><p><span class="bold"><strong>Limitation</strong></span></p>
						</td><td colspan="2" valign="top"><p>Pour ne pas modifier les sous-routes originales, le <span class="bold"><strong>cIntercept</strong></span> peut &ecirc;tre utilis&eacute; uniquement dans une
								sous-route s&eacute;par&eacute;e.</p>
						</td></tr></tbody></table></div></div><div class="section" title="Sc&eacute;nario : Intercepter plusieurs routes et les rediriger dans une seule nouvelle route"><div class="titlepage"><div><div><h3 class="title"><a name="Raa87706"></a>Sc&eacute;nario : Intercepter plusieurs routes et les rediriger dans une seule nouvelle
			route</h3></div></div></div><p>Dans ce sc&eacute;nario, les messages de deux sous-routes sont intercept&eacute;s et rout&eacute;s dans une
			nouvelle sous-route, termin&eacute;e avant que les sous-routes originales ne continuent.</p><div class="mediaobject"><img src="../images/use_case_cintercept1.png"></div><div class="section" title="D&eacute;poser et relier les composants"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1620"></a>D&eacute;poser et relier les composants</h4></div></div></div><p>Ce sc&eacute;nario requiert cinq composants <span class="bold"><strong>cFile</strong></span>, un <span class="bold"><strong>cIntercept</strong></span>, un <span class="bold"><strong>cProcessor</strong></span> et un <span class="bold"><strong>cStop</strong></span>.</p><div class="procedure"><ol class="procedure" type="1"><li class="step" title="&Eacute;tape 1"><p>De la famille <span class="bold"><strong>Messaging</strong></span> dans la <span class="bold"><strong>Palette</strong></span>, d&eacute;posez quatre composants <span class="bold"><strong>cFile</strong></span> dans l'espace de mod&eacute;lisation graphique. </p></li><li class="step" title="&Eacute;tape 2"><p>Reliez les deux paires de <span class="bold"><strong>cFile</strong></span> &agrave; l'aide de liens
							<span class="bold"><strong>Row</strong></span> &gt; <span class="bold"><strong>Route</strong></span>. Les messages de ces deux sous-routes seront
						intercept&eacute;s.</p></li><li class="step" title="&Eacute;tape 3"><p>Du dossier <span class="bold"><strong>Exception</strong></span>, d&eacute;posez un <span class="bold"><strong>cIntercept</strong></span> dans l'espace de mod&eacute;lisation graphique.</p></li><li class="step" title="&Eacute;tape 4"><p>Du dossier <span class="bold"><strong>Processor</strong></span>, d&eacute;posez un composant <span class="bold"><strong>cProcessor</strong></span> dans l'espace de mod&eacute;lisation
						graphique.</p></li><li class="step" title="&Eacute;tape 5"><p>Du dossier <span class="bold"><strong>Messaging</strong></span>, d&eacute;posez un cinqui&egrave;me <span class="bold"><strong>cFile</strong></span> dans l'espace de mod&eacute;lisation
						graphique.</p></li><li class="step" title="&Eacute;tape 6"><p>Du dossier <span class="bold"><strong>Miscellaneous</strong></span>, d&eacute;posez un composant <span class="bold"><strong>cStop</strong></span> dans l'espace de mod&eacute;lisation graphique. </p></li><li class="step" title="&Eacute;tape 7"><p>Reliez ces quatre composants les uns aux autres &agrave; l'aide de liens <span class="bold"><strong>Row</strong></span> &gt; <span class="bold"><strong>Route</strong></span>. Dans cette
						sous-route, les messages intercept&eacute;s sont dirig&eacute;s vers un nouvel endpoint
						avant que la Route enti&egrave;re soit achev&eacute;e.</p></li><li class="step" title="&Eacute;tape 8"><p>Renommez les composants afin de mieux identifier leur r&ocirc;le dans la Route.</p></li></ol></div></div><div class="section" title="Configurer les composants et les connexions"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1710"></a>Configurer les composants et les connexions</h4></div></div></div><p>Dans ce sc&eacute;nario, le <span class="bold"><strong>cIntercept</strong></span> intercepte tous les
				messages des sous-routes d&egrave;s que les messages sont envoy&eacute;s et qu'ils n'ont pas de
				propri&eacute;t&eacute; &agrave; configurer. Le composant <span class="bold"><strong>cStop</strong></span> arr&ecirc;te
				la sous-route dans laquelle le message a &eacute;t&eacute; rejet&eacute; avant la fin du traitement et
				n'ayant pas de propri&eacute;t&eacute; &agrave; configurer. Vous devez donc configurer uniquement les
				messaging endpoints et les composants de monitoring.</p><div class="procedure"><ol class="procedure" type="1"><li class="step" title="&Eacute;tape 1"><p>Double-cliquez sur le <span class="bold"><strong>cFile</strong></span> nomm&eacute; <span class="italic">Sender_1</span> pour afficher sa vue <span class="bold"><strong>Basic settings</strong></span> dans l'onglet <span class="bold"><strong>Component</strong></span>. </p><div class="mediaobject"><img src="../images/use_case_cintercept2.png"></div></li><li class="step" title="&Eacute;tape 2"><p>Dans le champ <span class="bold"><strong>Path</strong></span>, sp&eacute;cifiez le chemin d'acc&egrave;s &agrave; la
						premi&egrave;re source dont vous envoyez vos messages et laissez les autres
						param&egrave;tres tels qu'ils sont.</p></li><li class="step" title="&Eacute;tape 3"><p>Double-cliquez sur le <span class="bold"><strong>cFile</strong></span> nomm&eacute; <span class="italic">Receiver_1</span> pour afficher sa vue <span class="bold"><strong>Basic settings</strong></span>.</p><div class="mediaobject"><img src="../images/use_case_cintercept3.png"></div></li><li class="step" title="&Eacute;tape 4"><p>Dans le champ <span class="bold"><strong>Path</strong></span>, sp&eacute;cifiez le chemin d'acc&egrave;s &agrave; la
						premi&egrave;re destination &agrave; laquelle vous envoyez des messages et laissez les
						autres param&egrave;tres tels qu'ils sont.</p></li><li class="step" title="&Eacute;tape 5"><p>De la m&ecirc;me fa&ccedil;on, configurez les composants <span class="bold"><strong>cFile</strong></span> nomm&eacute;s
							<span class="italic">Sender_2</span> et <span class="italic">Receiver_2</span> dans la seconde sous-route.</p></li><li class="step" title="&Eacute;tape 6"><p>Double-cliquez sur le composant <span class="bold"><strong>cProcessor</strong></span> nomm&eacute;
							<span class="italic">Monitor</span> pour afficher sa vue
							<span class="bold"><strong>Basic settings</strong></span> et personnalisez le code
						dans la zone <span class="bold"><strong>Code</strong></span> pour afficher le nom des
						fichiers des messages intercept&eacute;s, dans la console :</p><pre class="programlisting">System.out.println("Message intercepted: "+
exchange.getIn().getHeader("CamelFileName"));</pre></li><li class="step" title="&Eacute;tape 7"><p>Double-cliquez sur le composant <span class="bold"><strong>cFile</strong></span> nomm&eacute; <span class="italic">Receiver_3</span> pour afficher sa vue <span class="bold"><strong>Basic settings</strong></span>. </p><div class="mediaobject"><img src="../images/use_case_cintercept7.png"></div></li><li class="step" title="&Eacute;tape 8"><p>Dans le champ <span class="bold"><strong>Path</strong></span>, sp&eacute;cifiez le chemin d'acc&egrave;s au
						fichier de destination pour les messages intercept&eacute;s et laissez les autres
						param&egrave;tres tels qu'ils sont.</p></li><li class="step" title="&Eacute;tape 9"><p>Appuyez sur <span class="bold"><strong>Ctrl+S</strong></span> pour sauvegarder votre Route.</p></li></ol></div></div><div class="section" title="Visualiser du code et ex&eacute;cuter la Route"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1823"></a>Visualiser du code et ex&eacute;cuter la Route</h4></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="&Eacute;tape 1"><p>Cliquez sur l'onglet <span class="bold"><strong>Code</strong></span> au bas de l'espace de
						mod&eacute;lisation graphique pour visualiser le code g&eacute;n&eacute;r&eacute;.</p><div class="mediaobject"><img src="../images/use_case_cintercept8.png"></div><p>Comme affich&eacute; dans le morceau de code, le <span class="italic">Interceptor</span>
						intercepte tous les messages de la Route. Les messages intercept&eacute;s sont
						dirig&eacute;s vers (<code class="code">.to</code>) l'endpoint <span class="italic">Receiver_3</span> et le <span class="italic">cStop_1</span>
						termine le routage du message avant que les messages soient rout&eacute;s de
							l'(<code class="code">from</code>)endpoint <span class="italic">Sender_1</span> vers (<code class="code">.to</code>) l'endpoint <span class="italic">Receiver_1</span> et de l'(<code class="code">from</code>) endpoint
							<span class="italic">Sender_2</span> vers l'(<code class="code">.to</code>)
						endpoint <span class="italic">Receiver_2</span>. </p></li><li class="step" title="&Eacute;tape 2"><p>Cliquez sur la vue <span class="bold"><strong>Run</strong></span> et cliquez sur le bouton
							<span class="bold"><strong>Run</strong></span> pour lancer l'ex&eacute;cution de votre
						Route. Vous pouvez &eacute;galement appuyer sur <span class="bold"><strong>F6</strong></span>
						pour l'ex&eacute;cuter. </p><p>R&eacute;sultat : Les fichiers sont envoy&eacute;s des endpoints, captur&eacute;s par le composant <span class="bold"><strong>cIntercept</strong></span>, monitor&eacute;s par le <span class="bold"><strong>cProcessor</strong></span> et envoy&eacute;s vers un nouvel endpoint.
						Les sous-routes originales sont termin&eacute;es avant que les fichiers atteignent
						leur endpoint cible d'origine.</p><div class="mediaobject"><img src="../images/use_case_cintercept9.png"></div></li></ol></div></div></div></div></body></html>